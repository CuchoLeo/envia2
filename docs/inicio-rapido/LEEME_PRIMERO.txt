â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                          â•‘
â•‘   ğŸ“‹ SISTEMA DE SEGUIMIENTO DE Ã“RDENES DE COMPRA v1.3.2                â•‘
â•‘   Sistema automatizado para gestiÃ³n de OC en reservas hoteleras         â•‘
â•‘                                                                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸  IMPORTANTE: Los scripts Python requieren PYTHONPATH=. para funcionar
ğŸ’¡  Tip: Usa ./run_script.sh para ejecutar scripts de forma mÃ¡s fÃ¡cil

ğŸš€ INICIO RÃPIDO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£  LEER PRIMERO:
    ğŸ“„ docs/inicio-rapido/INICIO_RAPIDO.md        â† GuÃ­a de 10 minutos
    ğŸ“„ docs/inicio-rapido/GUIA_PRUEBA_LOCAL.md    â† GuÃ­a detallada
    ğŸ“„ ESTRUCTURA_PROYECTO.md                      â† Estructura del proyecto

2ï¸âƒ£  INSTALAR:
    python3 -m venv venv                           â† Crear entorno virtual
    source venv/bin/activate                       â† Activar entorno
    pip install -r requirements.txt                â† Instalar dependencias
    cp .env.example .env                           â† Copiar configuraciÃ³n
    nano .env                                      â† Configurar credenciales

3ï¸âƒ£  INICIALIZAR:
    PYTHONPATH=. python scripts/database/crear_bd.py            â† Crear BD
    PYTHONPATH=. python scripts/database/cargar_clientes_excel.py  â† Clientes
    # O usando el wrapper:
    ./run_script.sh scripts/database/crear_bd.py

4ï¸âƒ£  INICIAR SISTEMA:
    ./scripts/gestion/gestionar_sistema.sh start   â† Iniciar (recomendado)
    # O directamente:
    python app.py                                   â† Iniciar manualmente

5ï¸âƒ£  VERIFICAR:
    http://localhost:8001                          â† Abrir dashboard
    http://localhost:8001/reservas                 â† Ver todas las reservas
    http://localhost:8001/clientes                 â† Gestionar clientes

6ï¸âƒ£  ENVIAR PRUEBAS:
    PYTHONPATH=. python scripts/utils/enviar_prueba.py          â† Correos
    PYTHONPATH=. python scripts/testing/generar_pdf_prueba.py   â† PDFs
    # O usando el wrapper:
    ./run_script.sh scripts/utils/enviar_prueba.py


ğŸ“š DOCUMENTACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

README.md                                - DocumentaciÃ³n completa del sistema
docs/README.md                           - Ãndice de toda la documentaciÃ³n
docs/inicio-rapido/INICIO_RAPIDO.md      - GuÃ­a rÃ¡pida (10 minutos)
docs/inicio-rapido/GUIA_PRUEBA_LOCAL.md  - GuÃ­a detallada de pruebas
docs/DIAGRAMAS.md                        - Diagramas del sistema
ESTRUCTURA_PROYECTO.md                   - Estructura del proyecto
CHANGELOG.md                             - Historial de cambios


ğŸ”§ SCRIPTS ÃšTILES (Nueva estructura v1.3.0)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

GESTIÃ“N DEL SISTEMA (scripts/gestion/):
  ./scripts/gestion/gestionar_sistema.sh start    - Iniciar sistema
  ./scripts/gestion/gestionar_sistema.sh stop     - Detener sistema
  ./scripts/gestion/gestionar_sistema.sh restart  - Reiniciar sistema
  ./scripts/gestion/gestionar_sistema.sh status   - Ver estado
  ./scripts/gestion/gestionar_sistema.sh logs     - Ver logs en tiempo real

BASE DE DATOS (scripts/database/):
  python scripts/database/crear_bd.py             - Crear/inicializar BD
  python scripts/database/limpiar_base_datos.py   - Limpiar datos de prueba
  python scripts/database/cargar_clientes_excel.py - Cargar clientes desde Excel

TESTING (scripts/testing/):
  python scripts/testing/check_inbox.py           - Verificar correos recibidos
  python scripts/testing/generar_pdf_prueba.py    - Generar PDFs de prueba
  python scripts/testing/verificar_correos.py     - Verificar configuraciÃ³n

UTILIDADES (scripts/utils/):
  python scripts/utils/test_conexion.py           - Probar conexiÃ³n IMAP/SMTP
  python scripts/utils/configurar_cliente.py      - ConfiguraciÃ³n interactiva
  python scripts/utils/enviar_prueba.py           - Enviar correos de prueba

VERIFICACIÃ“N:
  python config.py                                 - Verificar configuraciÃ³n
  python database.py                               - Verificar base de datos


âš™ï¸  CONFIGURACIÃ“N MÃNIMA (.env)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Correo que recibe confirmaciones de reservas
IMAP_HOST=imap.gmail.com
IMAP_USERNAME=seguimientoocx@gmail.com
IMAP_PASSWORD=abcd efgh ijkl mnop          # â† ContraseÃ±a de aplicaciÃ³n Gmail

# Correo que envÃ­a solicitudes de OC
SMTP_HOST=smtp.gmail.com
SMTP_USERNAME=kontroltravel@ideasfractal.com
SMTP_PASSWORD=wxyz abcd efgh ijkl          # â† ContraseÃ±a de aplicaciÃ³n Gmail
SMTP_FROM_EMAIL=kontroltravel@ideasfractal.com

# Correo que recibe las OC de respuesta
OC_INBOX_HOST=imap.gmail.com
OC_INBOX_USERNAME=seguimientoocx@gmail.com
OC_INBOX_PASSWORD=abcd efgh ijkl mnop      # â† Misma que IMAP

# Base de datos (ya configurada)
DATABASE_URL=sqlite:///./data/oc_seguimiento.db

# Remitentes autorizados para enviar confirmaciones
ALLOWED_CONFIRMATION_SENDERS=kontroltravel@ideasfractal.com,v.rodriguezy@gmail.com,cuchohbk@gmail.com

# Clientes que requieren OC (opcional si usas Excel)
AGENCIES_REQUIRING_OC=WALVIS S.A.,EMPRESA CORPORATIVA LTDA


ğŸ¯ FLUJO DEL SISTEMA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Cliente hace reserva â†’ Kontrol Travel envÃ­a PDF confirmaciÃ³n por correo
2. Sistema detecta correo â†’ Extrae datos del PDF (13+ formatos de monto)
3. Verifica si cliente requiere OC â†’ Consulta BD (79 clientes configurados)
4. Crea registro en BD â†’ Estado: PENDIENTE
5. EnvÃ­a solicitud automÃ¡tica â†’ DÃA 0 (desde email_origen_fecha)
6. Si no responde â†’ Recordatorio DÃA 2
7. Si no responde â†’ UltimÃ¡tum DÃA 4
8. Cliente envÃ­a OC â†’ Sistema detecta por mÃºltiples patrones:
   - "Reserva CODIGO"
   - "LOC CODIGO"
   - "Orden de Compra CODIGO"
   - "OC CODIGO"
9. Marca como recibida â†’ Estado: RECIBIDA
10. Detiene recordatorios â†’ Proceso completo


ğŸ“§ CORREOS DE PRUEBA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Enviar a: seguimientoocx@gmail.com (tu casilla de monitoreo)

CONFIRMACIÃ“N DE RESERVA:
  Asunto: ConfirmaciÃ³n de Reserva Hotel
  Ã³: Resumen del Servicio
  Ã³: Reserva confirmada
  Adjunto: PDF con datos de reserva (campos requeridos: id_reserva, loc_interno, agencia, monto_total)

  âš ï¸  El PDF debe contener:
      - ID o LOC Interno
      - Nombre de agencia (exacto segÃºn BD)
      - Monto (soporta 13+ formatos)
      - Hotel, fechas (opcional pero recomendado)

ORDEN DE COMPRA:
  Asunto: OC para Reserva AAFVDUA
  Ã³: Orden de Compra - Reserva AAFVDUA
  Ã³: OC AAFVDUA
  Ã³: LOC TEST2024001 - Adjunto OC
  Adjunto: Cualquier PDF


ğŸŒ INTERFAZ WEB (Nuevas vistas v1.3.0)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Dashboard:       http://localhost:8001              # Dashboard principal
Reservas:        http://localhost:8001/reservas     # Vista completa con filtros
Clientes:        http://localhost:8001/clientes     # GestiÃ³n de 79 clientes
API REST:        http://localhost:8001/api/stats    # EstadÃ­sticas JSON
DocumentaciÃ³n:   http://localhost:8001/docs         # Swagger UI


ğŸ“Š API REST ÃšTIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Health check
curl http://localhost:8001/api/health

# EstadÃ­sticas del sistema
curl http://localhost:8001/api/stats

# Listar todas las reservas
curl http://localhost:8001/api/reservas

# Solo reservas pendientes
curl http://localhost:8001/api/reservas?estado=pendiente

# Listar clientes configurados
curl http://localhost:8001/api/clientes

# Procesar correos manualmente
curl -X POST http://localhost:8001/api/process-now


ğŸ› DEPURACIÃ“N Y LOGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ver logs en tiempo real:
  ./scripts/gestion/gestionar_sistema.sh logs
  # O directamente:
  tail -f logs/sistema.log

Ver estado del sistema:
  ./scripts/gestion/gestionar_sistema.sh status

Verificar correos en inbox:
  python scripts/testing/check_inbox.py

Verificar configuraciÃ³n:
  python config.py

Verificar base de datos:
  python scripts/database/limpiar_base_datos.py --stats


ğŸ—„ï¸  BASE DE DATOS (Nueva ubicaciÃ³n v1.3.0)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

UbicaciÃ³n:     data/oc_seguimiento.db
Clientes:      79 clientes configurados desde Excel
Reservas:      Todas las reservas procesadas
OC:            Ã“rdenes de compra recibidas

Gestionar datos:
  python scripts/database/limpiar_base_datos.py        # MenÃº interactivo
  python scripts/database/limpiar_base_datos.py --stats   # Ver estadÃ­sticas
  python scripts/database/limpiar_base_datos.py --list    # Listar reservas
  python scripts/database/limpiar_base_datos.py --test    # Eliminar TEST*
  python scripts/database/limpiar_base_datos.py --oc      # Eliminar solo OC


ğŸ’¡ TIPS IMPORTANTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Usa CONTRASEÃ‘AS DE APLICACIÃ“N de Gmail, no tu contraseÃ±a normal
âœ“ Activa "VerificaciÃ³n en 2 pasos" en Gmail primero
âœ“ El nombre de agencia debe coincidir con la configuraciÃ³n en BD
âœ“ El sistema ahora usa email_origen_fecha como DÃ­a 0 (no fecha_creacion)
âœ“ Los PDFs soportan 13+ formatos de monto (ver docs/DIAGRAMAS.md)
âœ“ Todos los scripts deben ejecutarse desde la RAÃZ del proyecto
âœ“ Para pruebas rÃ¡pidas: DAYS_FOR_REMINDER_1=0 y DAYS_FOR_REMINDER_2=0
âœ“ El sistema verifica correos cada 60 segundos (IMAP_CHECK_INTERVAL=60)


ğŸ“‚ ESTRUCTURA DEL PROYECTO v1.3.0
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

envia2/
â”œâ”€â”€ app.py, config.py, database.py    # Archivos principales
â”œâ”€â”€ src/                               # CÃ³digo fuente
â”œâ”€â”€ templates/                         # HTML (dashboard, reservas, clientes)
â”œâ”€â”€ scripts/                           # Scripts organizados por funciÃ³n
â”‚   â”œâ”€â”€ gestion/                       # GestiÃ³n del sistema
â”‚   â”œâ”€â”€ database/                      # Scripts de base de datos
â”‚   â”œâ”€â”€ testing/                       # Scripts de prueba
â”‚   â””â”€â”€ utils/                         # Utilidades generales
â”œâ”€â”€ docs/                              # DocumentaciÃ³n categorizada
â”‚   â”œâ”€â”€ inicio-rapido/                 # EstÃ¡s aquÃ­
â”‚   â”œâ”€â”€ arquitectura/
â”‚   â”œâ”€â”€ cliente/
â”‚   â”œâ”€â”€ configuracion/
â”‚   â””â”€â”€ troubleshooting/
â”œâ”€â”€ data/                              # Base de datos y datos del sistema
â”œâ”€â”€ tests/                             # Tests automatizados
â””â”€â”€ logs/                              # Logs del sistema

Ver ESTRUCTURA_PROYECTO.md para detalles completos.


â“ AYUDA Y SOPORTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Lee docs/inicio-rapido/INICIO_RAPIDO.md para comenzar
2. Lee docs/inicio-rapido/GUIA_PRUEBA_LOCAL.md para guÃ­a detallada
3. Lee README.md para documentaciÃ³n completa del sistema
4. Lee docs/troubleshooting/TROUBLESHOOTING.md para solucionar problemas
5. Lee scripts/README.md para documentaciÃ³n de scripts
6. Revisa logs/ para depurar problemas especÃ­ficos


ğŸ†• NOVEDADES v1.3.0
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ¨ ReorganizaciÃ³n completa del proyecto con estructura profesional
âœ¨ Sistema de gestiÃ³n integrado (gestionar_sistema.sh)
âœ¨ Scripts organizados en 4 categorÃ­as
âœ¨ DocumentaciÃ³n categorizada por tipo y audiencia
âœ¨ Nueva vista /reservas con filtros y bÃºsqueda
âœ¨ Nueva vista /clientes para gestiÃ³n de 79 clientes
âœ¨ Diagrama de estructura del proyecto
âœ¨ Base de datos centralizada en data/


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ‰ Â¡Listo para empezar!                                                 â•‘
â•‘                                                                          â•‘
â•‘  1. Configura .env con tus credenciales Gmail                            â•‘
â•‘  2. Ejecuta: python scripts/database/crear_bd.py                         â•‘
â•‘  3. Inicia:  ./scripts/gestion/gestionar_sistema.sh start                â•‘
â•‘  4. Abre:    http://localhost:8001                                       â•‘
â•‘                                                                          â•‘
â•‘  ğŸ“– DocumentaciÃ³n completa: docs/README.md                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VersiÃ³n: 1.3.0 | Ãšltima actualizaciÃ³n: 8 de Diciembre de 2024
